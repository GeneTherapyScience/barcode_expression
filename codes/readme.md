# Tools to analyze WSN/stg data of barcoded cells

## File formats
- .wsn : lines including barcode, reads and mutated-reads.
  ```
  WSN	Total	Mut
  TCAAGTTGAAGGTGCTGCAGTTGCACATCT	420092	1457
  AGATGCTGAAGGAGATGAAGCAGCTGCACA	121098	443
  TGATGTACATGCTGAAGTAGCTCGTGATGC 	27971	84
  ...
  ```

- .bar : list of barcodes.
  ```
  TCAAGTTGAAGGTGCTGCAGTTGCACATCT
  AGATGCTGAAGGAGATGAAGCAGCTGCACA
  TGATGTACATGCTGAAGTAGCTCGTGATGC
  ...
  ```

- .wsnstg : lines including barcode, stg and reads.
  ```
  WSN	stg	reads
  TCAAGTTGAAGGTGCTGCAGTTGCACATCT	GGTGGCTTTACCAACAGTAC	23044
  AGATGCTGAAGGAGATGAAGCAGCTGCACA	GGTGGCTTTACCAACAGTAC	7387
  AGGACGTGGAGAACCAGTTCGACAACGAGG	GGTGGCTTTACCAACAGTAC	3772
  ...
  ```

- .stg : list of stg sequences
  ```
  AAAAAATTTACCAACAGTAC
  AAACACCGGTGGCTTTACCAACAGTAC
  AAACACCGGTGGCTTTTACCGGTGGCTTTACCAACAGTAC
  AAACGGTGGCTTTACCAACAGTAC
  ...
  ```

- .stgmixd : lines including distance from the template, total reads, barcode variations, stg sequence and the MIXD string of alignment (M: match, I: insertion, X: mismatch, D: deletion). 
  ```
  distance reads WSN's stg mixd
  0.0     6418242 694576  GGTGGCTTTACCAACAGTAC    MMMMMMMMMMMMMMMMMMMM
  1.0     1330    1173    GGTGGCTTCACCAACAGTAC    MMMMMMMMXMMMMMMMMMMM
  2.5     3808    951     GGTGGCTTTACCAACATAC     MMMMMMMMMMMMMMMMDMMM
  ...
  ```

## bin/
- checkWSN.py : Check percentage of WSN barcodes in the input data.
  ```bash
  $ python3 checkWSN.py < sample.wsn > output
  ```

- compare_data.py : Compute correlations (Pearson/Spearman) between two datasets of barcode-reads.
  ```bash
  $ python3 compare_data.py sample1.wsn sample2.wsn > output
  ```

- count_NG_reads.py : Count reads of decendants of initial irregular stg.
  ```bash
  $ python3 count_NG_reads.py dict.stgokng < sample.stgmixd > output
  ```

- count_mut_barcodes.py : Count variations including stg mutations, for each environments (NT, DTX, Sp). Inputs are generated by `stg_tables.py`.
  ```bash
  $ python3 count_mut_barcodes.py clone1.tsv [clone2.tsv ...] > output
  ```

- count_mut_barcodes2.py : Similar to `count_mut_barcodes.py`. Count variations `k` samples (`k=0,1,2,....`) of which include stg mutations, for each envirionment.
  ```bash
  $ python3 count_mut_barcodes2.py clone1.tsv [clone2.tsv ...] > output
  ```

- extractWSN.py : Delete lines of non-WSN barcode.
  ```bash
  $ python3 extractWSN.py < sample.wsn > output.wsn
  ```

- filter_wsnstg.py : Keep barcodes given to stdin, in each `.wsnstg` file given in command-line. Results are written in corresponding `.filtered.wsnstg` files.
  ```bash
  $ python3 filter_wsnstg.py sample1.wsnstg [sample2.wsnstg ...] < reference_barcodes.bar
  ```

- generate_commonbarcodes_table.py : Reads & proportions of barcodes, included in the reference file.
  ```bash
  $ python3 generate_commonbarcodes_table.py reference.wsn input.wsn output_total.tsv output_top10.tsv
  ```

- generate_JSD_table.py : Make tables of Jensen-Shannon Divergence, between different samples in a same clone.
  ```bash
  $ python3 generate_JSD_table.py reference.wsn input.wsn output_total.wsn output_top10.wsn
  ```

- included.py : Extract lines of barcodes included in the reference.
  ```bash
  $ python3 included.py reference.wsn input.wsn > output.wsn
  ```

- judge_stg.py : Give `OK` to template-originated stg, and `NG` to others.
  ```bash
  $ python3 judge_stg.py
  ```

- make_wsn_list.py : Make a list of wsn's, included both in the plasmid and in any of the clones.
  ```bash
  $ python3 make_wsn_list.py
  ```

- matchuniqhamm2.sh : Merge barcodes within Hamming distance 2 in `.uniq` files, using `merge_readerror.py`.
  ```bash
  $ bash matchuniqhamm2.sh
  ```

- merge_readerror.py : Merge barcodes by Hamming/Levenstein distances in wsn & reads list.
  ```bash
  $ python3 merge_readerror.py
  ```

- mutpos.py : Make histogram data of stg mutations at each position.
  ```bash
  $ python3 mutpos.py
  ```

- pickwsnlen.py : Extract lines with barcodes of 28-32 of length.
  ```bash
  $ python3 pickwsnlen.py
  ```

- pickwsnlen30.py : Extract lines with barcodes of length 30.
  ```bash
  $ python3 pickwsnlen30.py
  ```

- sam2pair.py : pipe `.sam` data to `.wsnstg` data.
  ```bash
  $ python3 sam2pair.py
  ```

- sam2wsnstg_batch.py : Generate `.wsnstg` files from `.sam` files.
  ```bash
  $ python3 sam2wsnstg_batch.py
  ```

- seq_distribution.py : Show distributions of distances between barcodes.
  ```bash
  $ python3 seq_distribution.py
  ```

- singleread_percentage.py : Show read-based ratio of single-read barcodes.
  ```bash
  $ python3 singleread_percentage.py
  ```

- start_end_reads.py : Output increment/decrement of reads of each barcode, from Day0 to Day7/Day14.
  ```bash
  $ python3 start_end_reads.py
  ```

- stg2stgmixd.py : Add mixd & distance data to stg list.
  ```bash
  $ python3 stg2stgmixd.py
  ```

- stg_reads_corr.py : Output tables of Pearson/Spearman correlations between reads & mutations.
  ```bash
  $ python3 stg_reads_corr.py
  ```

- stg_tables.py : Make mutation data table from .wsnstg files.
  ```bash
  $ python3 stg_tables.py
  ```

- stg_valid_barcodes.py : Extract barcodes included in all of the reference & given datafiles.
  ```bash
  $ python3 stg_valid_barcodes.py
  ```

- take_subset.py : Make a random-extraction without replacement, from a dataset given to stdin.
  ```bash
  $ python3 take_subset.py
  ```

- wsnstg2mutinfo.py : Make `.mutinfo` files including basic mutation data for each barcode, from `.wsnstg` files.
  ```bash
  $ python3 wsnstg2mutinfo.py
  ```

- wsnstg2stg.py : Make `.stg` files including reads, WSN variations and MIXD alignment for each stg sequence, from `.wsnstg` files.
  ```bash
  $ python3 wsnstg2stg.py
  ```

- wsnstg2white.py : Remove strange (not originated from the template) stg's from wsnstg files, making `.white40.wsnstg` files.
  ```bash
  $ python3 wsnstg2white.py
  ```

- wsnstg2wsn.py : Make `.wsn` files from `.wsnstg` files, merging all stg's per wsn.
  ```bash
  $ python3 wsnstg2wsn.py
  ```

- wsnstg2wsnmixd.py : Make `.wsnmixd` & `.indelinfo` files from `.wsnstg` files.
  ```bash
  $ python3 wsnstg2wsnmixd.py
  ```

## lib/
- alignment.py : Library for finding best alignments between template and target sequences, to analyze stg mutations.
- analyze_data01.py : Library to load wsn-stg data from datafiles.
- barcodelib.py : Library of functions used in many scripts.

## utils/
- mannwhitneyu.py : Carry out Mann-Whiteney U-test for input data from stdin.
- random_barcode.py : Generate list of random WSN barcodes.
- random_variations.py : Simulate variations after incubations.
- showprogress : Show the last lines of given files.
- survey_orphans.py : Give nearest barcodes & distance for some sampled barcodes.
- survey_orphans2.py : Give how many barcodes are within given radius, for some sampled barcodes.
- totalread.py : Output variations, reads, mutatiion and shannon-variation of a dataset given to stdin.
- wsn2ref.sh : Make merged dataset with length 30, using merge_readerror.py
